<!DOCTYPE html>
<html>
  <head>
    <!-- standard stuff for head -->
    <title>Placeholder Name</title>
    <script type="text/javascript" src="static/js/main.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
 </head>
  <body>
    <h1>Kanban Boards</h1>
    
    <ul>
      <li><a href='/'>Home</a></li>
    </ul>
      
    <ul>
      {% for list in lists %}
      <button id="{{list}}" onclick="selectTheList(this.id)"><li>{{list}}</li></button><br>
      {% endfor %}
    </ul>

    <button type="button" onclick="openPopup()">Create New Board</button>

    <div class="popup-overlay" id="popup-overlay">
      <div class="popup" id="boardname">
        <button class="close" id="closePopup" onclick="closePopupFunc()">&times;</button>
        <div class="popup-content">
          <p>Please enter a name for your board</p>
          <input type="text" placeholder="Todo List" id="kanbanName">
          <button onclick="submitName()">Create</button>
        </div>
      </div>
    </div>

    <div class="popup-overlay" id="popup-overlay-list">
      <div class="popup" id="listname">
        <button class="close" id="closePopup" onclick="closeListPopupFunc()">&times;</button>
        <div class="popup-content">
          <p>Please enter a name for your list</p>
          <input type="text" placeholder="List Name" id="listName">
          <button onclick="createBoardList()">Create</button>
        </div>
      </div>
    </div>

  <div class="popup-overlay" id="popup-overlay-item">
      <div class="popup" id="itemname">
        <button class="close" id="closePopup" onclick="closeItemPopupFunc()">&times;</button>
        <div class="popup-content">
          <p>Please enter the task name</p>
          <input type="text" placeholder="Task Name" id="itemName">
          <button onclick="newItemOnList()">Create</button>
        </div>
      </div>
    </div>

    <div class="board-container" id="board-container">
      <button onclick="openListPopup()">New List</button>
    </div>

    <input name="user_id" id="user_id" value="{{ user_id }}" type="hidden" style="position: absolute;">

    <script type="text/javascript">
    // JavaScript for drag and resize functionality
    const container = document.getElementById('board-container');
    const draggables = document.querySelectorAll('.draggable');

    let offsetX, offsetY, draggedElement, isResizing = false, startX, startY, startWidth, startHeight;

    draggables.forEach(draggable => {
        const resizeHandle = draggable.querySelector('.resize-handle');

        draggable.addEventListener('mousedown', function (e) {
            if (e.target.classList.contains('resize-handle')) return;
            draggedElement = this;
            offsetX = e.clientX - draggedElement.getBoundingClientRect().left;
            offsetY = e.clientY - draggedElement.getBoundingClientRect().top;

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        resizeHandle.addEventListener('mousedown', function (e) {
            e.stopPropagation();
            isResizing = true;
            draggedElement = draggable;
            startX = e.clientX;
            startY = e.clientY;
            startWidth = parseInt(document.defaultView.getComputedStyle(draggedElement).width, 10);
            startHeight = parseInt(document.defaultView.getComputedStyle(draggedElement).height, 10);

            document.addEventListener('mousemove', onResize);
            document.addEventListener('mouseup', onMouseUp);
        });
    });

    function onMouseMove(e) {
        if (!draggedElement || isResizing) return;

        let newX = e.clientX - offsetX;
        let newY = e.clientY - offsetY;

        // Keep the element within the container bounds
        const containerRect = container.getBoundingClientRect();
        const elementRect = draggedElement.getBoundingClientRect();

        if (newX < 0) newX = 0;
        if (newY < 0) newY = 0;
        if (newX + elementRect.width > containerRect.width) {
            newX = containerRect.width - elementRect.width;
        }
        if (newY + elementRect.height > containerRect.height) {
            newY = containerRect.height - elementRect.height;
        }

        // Move the dragged element
        draggedElement.style.left = newX + 'px';
        draggedElement.style.top = newY + 'px';
    }

    function onResize(e) {
        if (!isResizing) return;

        let newWidth = startWidth + (e.clientX - startX);
        let newHeight = startHeight + (e.clientY - startY);

        // Set minimum size
        if (newWidth > 100) draggedElement.style.width = newWidth + 'px';
        if (newHeight > 100) draggedElement.style.height = newHeight + 'px';
    }

    function onMouseUp() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        document.removeEventListener('mousemove', onResize);
        document.removeEventListener('mouseup', onMouseUp);
        draggedElement = null;
        isResizing = false;
    }
    console.log('this is working!');
    </script>
    
  </body>
</html>
